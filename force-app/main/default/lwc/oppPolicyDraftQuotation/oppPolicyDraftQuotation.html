<template>
    <template if:true={policies}>
        <template for:each={policies} for:item="policy">
            <!-- <lightning-card key={policy.policy.Id} title={policy.policy.Name} icon-name="standard:quotes"> -->
            <lightning-card key={policy.policy.Id}>
                
                <div class="slds-text-heading_medium">
                    <lightning-icon icon-name="standard:drafts" size="small"></lightning-icon> Policy Draft: {policy.policy.Name}
                </div>
                <div class="slds-text-heading_small">                    
                    <p>Policy Draft Status: {policy.policy.Status__c}</p>                   
                </div>
                <div class="slds-p-around_medium">
                    <template if:true={policy.quotesWithCompanies}>
                        <template for:each={policy.quotesWithCompanies} for:item="quoteWithCompanies">
                            <!-- <lightning-card key={quoteWithCompanies.quote.Id} title={quoteWithCompanies.quote.Name} icon-name="custom:custom70"> -->
                            <lightning-card key={quoteWithCompanies.quote.Id}>                                
                                <div class="slds-text-heading_small">
                                    <lightning-icon icon-name="standard:quotes" size="small"></lightning-icon> 
                                    MGA Quote: {quoteWithCompanies.quote.Name} 
                                </div>
                                <div class="slds-m-around_medium">
                                    <p><strong>MGA Company: </strong>                                        

                                        <template if:true={quoteWithCompanies.quote.MGA_Company__r}>
                                            {quoteWithCompanies.quote.MGA_Company__r.Name}
                                        </template>
                                        <template if:false={quoteWithCompanies.quote.MGA_Company__r}>
                                            No MGA assigned
                                        </template>
                                        
                                    </p>
                                    <p><strong>Indication:</strong> {quoteWithCompanies.quote.Indication__c}</p>
                                    <p><strong>Status:</strong> {quoteWithCompanies.quote.Status__c}</p>
                                    <p><strong>Created Date:</strong>
                                        <lightning-formatted-date-time value={quoteWithCompanies.quote.CreatedDate}></lightning-formatted-date-time>
                                    </p>
                                </div>
                                <div class="slds-p-around_medium">
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                        <thead>
                                            <tr>
                                                <th scope="col">
                                                    <div class="slds-truncate" title="Insurance Company">Insurance Company</div>
                                                </th>
                                                <th scope="col">
                                                    <div class="slds-truncate" title="Premium">Premium</div>
                                                </th>
                                                <th scope="col">
                                                    <div class="slds-truncate" title="Status">Status</div>
                                                </th>
                                                <th scope="col">
                                                    <div class="slds-truncate" title="Top Pick">Top Pick</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template if:true={quoteWithCompanies.insuranceCompanies.length}>
                                                <template for:each={quoteWithCompanies.insuranceCompanies} for:item="insuranceCompany">
                                                    <tr key={insuranceCompany.Id}>
                                                        <td data-label="Insurance Company">
                                                            {insuranceCompany.Insurance_Company__r.Name}
                                                        </td>
                                                        <td data-label="Premium">
                                                            {insuranceCompany.Premium__c}
                                                        </td>
                                                        <td class={insuranceCompany.Status_Class__c}>{insuranceCompany.Status__c}</td>
                                                        <td data-label="Top Pick">
                                                            <lightning-input type="checkbox" checked={insuranceCompany.Top_Pick__c} disabled></lightning-input>
                                                            <!-- {insuranceCompany.Top_Pick__c} -->
                                                        </td>
                                                    </tr>
                                                </template>
                                            </template>
                                            <template if:false={quoteWithCompanies.insuranceCompanies.length}>
                                                <tr>
                                                    <td colspan="2">
                                                        No insurance companies found.
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </lightning-card>
                        </template>
                    </template>
                </div>
            </lightning-card>
        </template>
    </template>
    <template if:false={policies}>
        <p>No policies or related quotes found.</p>
    </template>
</template>